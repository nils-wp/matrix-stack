# =============================================================================
# MAUTRIX-WHATSAPP BRIDGE CONFIGURATION
# Dokumentation: https://docs.mau.fi/bridges/go/whatsapp/
# =============================================================================

homeserver:
  address: http://synapse:8008
  domain: ${BASE_DOMAIN}
  software: standard

appservice:
  address: http://whatsapp-bridge:29318
  hostname: 0.0.0.0
  port: 29318
  database:
    type: sqlite3-fk-wal
    uri: /data/whatsapp.db
  id: whatsapp
  bot:
    username: whatsappbot
    displayname: WhatsApp Bridge Bot
    avatar: mxc://maunium.net/NeXNQarUbrlYBiPCpprYsRqr
  as_token: ${WHATSAPP_AS_TOKEN}
  hs_token: ${WHATSAPP_HS_TOKEN}

bridge:
  username_template: whatsapp_{{.}}
  displayname_template: "{{if .BusinessName}}{{.BusinessName}}{{else if .PushName}}{{.PushName}}{{else}}{{.JID}}{{end}} (WA)"
  
  # Permissions: Wer darf die Bridge nutzen?
  permissions:
    "*": relay
    "${BASE_DOMAIN}": user
    "@admin:${BASE_DOMAIN}": admin

  # Relay Mode für Gruppen ohne eigenen WA-Account
  relay:
    enabled: true
    message_formats:
      m.text: "<b>{{ .Sender.Displayname }}</b>: {{ .Message }}"
      m.notice: "<b>{{ .Sender.Displayname }}</b>: {{ .Message }}"
      m.emote: "* <b>{{ .Sender.Displayname }}</b> {{ .Message }}"
      m.file: "<b>{{ .Sender.Displayname }}</b> sent a file"
      m.image: "<b>{{ .Sender.Displayname }}</b> sent an image"
      m.audio: "<b>{{ .Sender.Displayname }}</b> sent an audio file"
      m.video: "<b>{{ .Sender.Displayname }}</b> sent a video"
      m.location: "<b>{{ .Sender.Displayname }}</b> sent a location"

  # Features
  history_sync:
    create_portals: true
    backfill: true
    max_initial_conversations: 20
  
  # Medien
  allow_user_invite: true
  delivery_receipts: true
  send_presence_on_typing: true
  
  # Double Puppeting (Optional, für bessere UX)
  double_puppet_server_map: {}
  login_shared_secret_map: {}

logging:
  min_level: warn
  writers:
    - type: stdout
      format: pretty-colored
